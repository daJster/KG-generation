<html>
    <head>
        <meta charset="utf-8">
        
            <script>function neighbourhoodHighlight(params) {
  // console.log("in nieghbourhoodhighlight");
  allNodes = nodes.get({ returnType: "Object" });
  // originalNodes = JSON.parse(JSON.stringify(allNodes));
  // if something is selected:
  if (params.nodes.length > 0) {
    highlightActive = true;
    var i, j;
    var selectedNode = params.nodes[0];
    var degrees = 2;

    // mark all nodes as hard to read.
    for (let nodeId in allNodes) {
      // nodeColors[nodeId] = allNodes[nodeId].color;
      allNodes[nodeId].color = "rgba(200,200,200,0.5)";
      if (allNodes[nodeId].hiddenLabel === undefined) {
        allNodes[nodeId].hiddenLabel = allNodes[nodeId].label;
        allNodes[nodeId].label = undefined;
      }
    }
    var connectedNodes = network.getConnectedNodes(selectedNode);
    var allConnectedNodes = [];

    // get the second degree nodes
    for (i = 1; i < degrees; i++) {
      for (j = 0; j < connectedNodes.length; j++) {
        allConnectedNodes = allConnectedNodes.concat(
          network.getConnectedNodes(connectedNodes[j])
        );
      }
    }

    // all second degree nodes get a different color and their label back
    for (i = 0; i < allConnectedNodes.length; i++) {
      // allNodes[allConnectedNodes[i]].color = "pink";
      allNodes[allConnectedNodes[i]].color = "rgba(150,150,150,0.75)";
      if (allNodes[allConnectedNodes[i]].hiddenLabel !== undefined) {
        allNodes[allConnectedNodes[i]].label =
          allNodes[allConnectedNodes[i]].hiddenLabel;
        allNodes[allConnectedNodes[i]].hiddenLabel = undefined;
      }
    }

    // all first degree nodes get their own color and their label back
    for (i = 0; i < connectedNodes.length; i++) {
      // allNodes[connectedNodes[i]].color = undefined;
      allNodes[connectedNodes[i]].color = nodeColors[connectedNodes[i]];
      if (allNodes[connectedNodes[i]].hiddenLabel !== undefined) {
        allNodes[connectedNodes[i]].label =
          allNodes[connectedNodes[i]].hiddenLabel;
        allNodes[connectedNodes[i]].hiddenLabel = undefined;
      }
    }

    // the main node gets its own color and its label back.
    // allNodes[selectedNode].color = undefined;
    allNodes[selectedNode].color = nodeColors[selectedNode];
    if (allNodes[selectedNode].hiddenLabel !== undefined) {
      allNodes[selectedNode].label = allNodes[selectedNode].hiddenLabel;
      allNodes[selectedNode].hiddenLabel = undefined;
    }
  } else if (highlightActive === true) {
    // console.log("highlightActive was true");
    // reset all nodes
    for (let nodeId in allNodes) {
      // allNodes[nodeId].color = "purple";
      allNodes[nodeId].color = nodeColors[nodeId];
      // delete allNodes[nodeId].color;
      if (allNodes[nodeId].hiddenLabel !== undefined) {
        allNodes[nodeId].label = allNodes[nodeId].hiddenLabel;
        allNodes[nodeId].hiddenLabel = undefined;
      }
    }
    highlightActive = false;
  }

  // transform the object into an array
  var updateArray = [];
  if (params.nodes.length > 0) {
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        // console.log(allNodes[nodeId]);
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  } else {
    // console.log("Nothing was selected");
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        // console.log(allNodes[nodeId]);
        // allNodes[nodeId].color = {};
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  }
}

function filterHighlight(params) {
  allNodes = nodes.get({ returnType: "Object" });
  // if something is selected:
  if (params.nodes.length > 0) {
    filterActive = true;
    let selectedNodes = params.nodes;

    // hiding all nodes and saving the label
    for (let nodeId in allNodes) {
      allNodes[nodeId].hidden = true;
      if (allNodes[nodeId].savedLabel === undefined) {
        allNodes[nodeId].savedLabel = allNodes[nodeId].label;
        allNodes[nodeId].label = undefined;
      }
    }

    for (let i=0; i < selectedNodes.length; i++) {
      allNodes[selectedNodes[i]].hidden = false;
      if (allNodes[selectedNodes[i]].savedLabel !== undefined) {
        allNodes[selectedNodes[i]].label = allNodes[selectedNodes[i]].savedLabel;
        allNodes[selectedNodes[i]].savedLabel = undefined;
      }
    }

  } else if (filterActive === true) {
    // reset all nodes
    for (let nodeId in allNodes) {
      allNodes[nodeId].hidden = false;
      if (allNodes[nodeId].savedLabel !== undefined) {
        allNodes[nodeId].label = allNodes[nodeId].savedLabel;
        allNodes[nodeId].savedLabel = undefined;
      }
    }
    filterActive = false;
  }

  // transform the object into an array
  var updateArray = [];
  if (params.nodes.length > 0) {
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  } else {
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  }
}

function selectNode(nodes) {
  network.selectNodes(nodes);
  neighbourhoodHighlight({ nodes: nodes });
  return nodes;
}

function selectNodes(nodes) {
  network.selectNodes(nodes);
  filterHighlight({nodes: nodes});
  return nodes;
}

function highlightFilter(filter) {
  let selectedNodes = []
  let selectedProp = filter['property']
  if (filter['item'] === 'node') {
    let allNodes = nodes.get({ returnType: "Object" });
    for (let nodeId in allNodes) {
      if (allNodes[nodeId][selectedProp] && filter['value'].includes((allNodes[nodeId][selectedProp]).toString())) {
        selectedNodes.push(nodeId)
      }
    }
  }
  else if (filter['item'] === 'edge'){
    let allEdges = edges.get({returnType: 'object'});
    // check if the selected property exists for selected edge and select the nodes connected to the edge
    for (let edge in allEdges) {
      if (allEdges[edge][selectedProp] && filter['value'].includes((allEdges[edge][selectedProp]).toString())) {
        selectedNodes.push(allEdges[edge]['from'])
        selectedNodes.push(allEdges[edge]['to'])
      }
    }
  }
  selectNodes(selectedNodes)
}</script>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/dist/vis-network.min.css" integrity="sha512-WgxfT5LWjfszlPHXRmBWHkV2eceiWTOBvrKCNbdgDYTHrT2AeLCGbF4sZlZw3UMN3WtL0tGUoIAKsu8mllg/XA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
            <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js" integrity="sha512-LnvoEWDFrqGHlHmDD2101OrLcbsfkrzoSpvtSQtxK3RMnRV0eOkhhBN2dXHKRrUU8p2DGRTk35n4O8nWSVe1mQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            
            
            
            
            
            

        
<center>
<h1></h1>
</center>

<!-- <link rel="stylesheet" href="../node_modules/vis/dist/vis.min.css" type="text/css" />
<script type="text/javascript" src="../node_modules/vis/dist/vis.js"> </script>-->
        <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
          crossorigin="anonymous"
        />
        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
          crossorigin="anonymous"
        ></script>


        <center>
          <h1></h1>
        </center>
        <style type="text/css">

             #mynetwork {
                 width: 100%;
                 height: 600px;
                 background-color: #ffffff;
                 border: 1px solid lightgray;
                 position: relative;
                 float: left;
             }

             

             

             
        </style>
    </head>


    <body>
        <div class="card" style="width: 100%">
            
            
            <div id="mynetwork" class="card-body"></div>
        </div>

        
        

        <script type="text/javascript">

              // initialize global variables.
              var edges;
              var nodes;
              var allNodes;
              var allEdges;
              var nodeColors;
              var originalNodes;
              var network;
              var container;
              var options, data;
              var filter = {
                  item : '',
                  property : '',
                  value : []
              };

              

              

              // This method is responsible for drawing the graph, returns the drawn network
              function drawGraph() {
                  var container = document.getElementById('mynetwork');

                  

                  // parsing and collecting nodes and edges from the python
                  nodes = new vis.DataSet([{"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "revolte des vignerons du Midi", "head_type": "concept", "id": "revolte des vigneron...", "label": "revolte des vigneron...", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : revolte des vignerons du Midi"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "revolte Des gueux", "id": "revolte Des gueux", "label": "revolte Des gueux", "shape": "dot", "size": 10, "tail_type": "concept", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : revolte Des gueux"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Emmanuel Petit", "id": "Emmanuel Petit", "label": "Emmanuel Petit", "shape": "dot", "size": 10, "tail_type": "concept", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Emmanuel Petit"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Christophe Leveque", "id": "Christophe Leveque", "label": "Christophe Leveque", "shape": "dot", "size": 10, "tail_type": "concept", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Christophe Leveque"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Georges Clemenceau", "head_type": "per", "id": "Georges Clemenceau", "label": "Georges Clemenceau", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Georges Clemenceau"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "president du Conseil et ministre de l\u0027Interieur", "id": "president du Conseil...", "label": "president du Conseil...", "shape": "dot", "size": 10, "tail_type": "per", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : president du Conseil et ministre de l\u0027Interieur"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "president du Conseil", "id": "president du Conseil", "label": "president du Conseil", "shape": "dot", "size": 10, "tail_type": "per", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : president du Conseil"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "mutine", "head_type": "concept", "id": "mutine", "label": "mutine", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : mutine"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "emotion", "id": "emotion", "label": "emotion", "shape": "dot", "size": 10, "tail_type": "concept", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : emotion"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Aude", "head_type": "loc", "id": "Aude", "label": "Aude", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Aude"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Midi", "head_type": "loc", "id": "Midi", "label": "Midi", "shape": "dot", "size": 10, "tail_type": "loc", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Midi"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "departements", "id": "departements", "label": "departements", "shape": "dot", "size": 10, "tail_type": "loc", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : departements"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Aveyron", "head_type": "loc", "id": "Aveyron", "label": "Aveyron", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Aveyron"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Gard", "head_type": "loc", "id": "Gard", "label": "Gard", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Gard"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "socialiste", "head_type": "org", "id": "socialiste", "label": "socialiste", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : socialiste"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Julien Simyan", "head_type": "per", "id": "Julien Simyan", "label": "Julien Simyan", "shape": "dot", "size": 10, "tail_type": "org", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Julien Simyan"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "1907", "head_type": "concept", "id": "1907", "label": "1907", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : 1907"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "janvier 1907", "id": "janvier 1907", "label": "janvier 1907", "shape": "dot", "size": 10, "tail_type": "time", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : janvier 1907"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "Emmanuel Brousse", "head_type": "per", "id": "Emmanuel Brousse", "label": "Emmanuel Brousse", "shape": "dot", "size": 10, "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : Emmanuel Brousse"}, {"color": "#8e3707", "fname": "14 Emmanuel Petit Christophe Leveque.pdf", "head_full": "gauche democratique", "id": "gauche democratique", "label": "gauche democratique", "shape": "dot", "size": 10, "tail_type": "per", "title": " from file : 14 Emmanuel Petit Christophe Leveque.pdf \n full name : gauche democratique"}]);
                  edges = new vis.DataSet([{"arrows": "to", "color": "#8e3707", "from": "revolte des vigneron...", "label": "part of", "to": "revolte Des gueux", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "revolte des vigneron...", "label": "participant", "to": "Emmanuel Petit", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "revolte des vigneron...", "label": "participant", "to": "Christophe Leveque", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Georges Clemenceau", "label": "position held", "to": "president du Conseil...", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Georges Clemenceau", "label": "position held", "to": "president du Conseil", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "mutine", "label": "instance of", "to": "emotion", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Aude", "label": "located in the administrative territorial entity...", "to": "Midi", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Aude", "label": "instance of", "to": "departements", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Midi", "label": "instance of", "to": "departements", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Midi", "label": "shares border with", "to": "Aveyron", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Midi", "label": "shares border with", "to": "Gard", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Aveyron", "label": "shares border with", "to": "Midi", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Aveyron", "label": "instance of", "to": "departements", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Aveyron", "label": "shares border with", "to": "Gard", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Gard", "label": "shares border with", "to": "Midi", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Gard", "label": "instance of", "to": "departements", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Gard", "label": "shares border with", "to": "Aveyron", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "socialiste", "label": "founded by", "to": "Julien Simyan", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Julien Simyan", "label": "member of political party...", "to": "socialiste", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "1907", "label": "point in time", "to": "janvier 1907", "width": 1}, {"arrows": "to", "color": "#8e3707", "from": "Emmanuel Brousse", "label": "member of political party...", "to": "gauche democratique", "width": 1}]);

                  nodeColors = {};
                  allNodes = nodes.get({ returnType: "Object" });
                  for (nodeId in allNodes) {
                    nodeColors[nodeId] = allNodes[nodeId].color;
                  }
                  allEdges = edges.get({ returnType: "Object" });
                  // adding nodes and edges to the graph
                  data = {nodes: nodes, edges: edges};

                  var options = {"edges": {"smooth": {"forceDirection": "none", "roundness": 0.15}}, "nodes": {"shape": "dot", "size": 16}, "physics": {"forceAtlas2Based": {"gravitationalConstant": -26, "centralGravity": 0.005, "springLength": 230, "springConstant": 0.18}, "maxVelocity": 146, "solver": "forceAtlas2Based", "timestep": 0.35, "stabilization": {"enabled": true, "iterations": 2000, "updateInterval": 25}}, "interaction": {"hover": true}};

                  


                  

                  network = new vis.Network(container, data, options);

                  

                  

                  


                  

                  return network;

              }
              drawGraph();
        </script>
    </body>
</html>
    <div class="popup" id="myPopup"></div>    
    
    <style>
    .lds-ellipsis {
    display: inline-block;
    position: relative;
    left: 50%;
    top: 5%;
    width: 90px;
    height: 90px;
    }
    .lds-ellipsis div {
    position: absolute;
    top: 33px;
    width: 13px;
    height: 13px;
    border-radius: 50%;
    background: #cef;
    animation-timing-function: cubic-bezier(0, 1, 1, 0);
    }
    .lds-ellipsis div:nth-child(1) {
    left: 8px;
    animation: lds-ellipsis1 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(2) {
    left: 8px;
    animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(3) {
    left: 32px;
    animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(4) {
    left: 56px;
    animation: lds-ellipsis3 0.6s infinite;
    }
    @keyframes lds-ellipsis1 {
    0% {
        transform: scale(0);
    }
    100% {
        transform: scale(1);
    }
    }
    @keyframes lds-ellipsis3 {
    0% {
        transform: scale(1);
    }
    100% {
        transform: scale(0);
    }
    }
    @keyframes lds-ellipsis2 {
    0% {
        transform: translate(0, 0);
    }
    100% {
        transform: translate(24px, 0);
    }
    }
    </style>
    <script>
    
    
    // function to get wikipedia details of a node    
    function details(nodeLabel, nodeTitle, nodeFname, nodeHeadFull, nodeTailFull, nodeHeadType, nodeTailType) {
        return `
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h1>${nodeHeadFull}</h1>
                    <p>From : ${nodeFname}</p>
                </div>
            </div>
        </div>
        `;
    }
    
    
    
    network.on("click", function (params) {
    if (params.nodes.length > 0) {
        var nodeId = params.nodes[0];
        network.focus(nodeId, {
        scale: 1.5,  // Adjust the scale as needed
        locked: false,
        animation: {
            duration: 1000,
            easingFunction: "easeInOutQuad"
        }
        });
        
        var node = network.body.nodes[nodeId];
        var nodeLabel = node.options.label;
        var nodeTitle = node.options.title;
        var nodeFname = node.options.fname;
        var nodeHeadFull = node.options.head_full;
        var nodeTailFull = node.options.tail_full;
        var nodeHeadType = node.options.head_type;
        var nodeTailType = node.options.tail_type;
        
        var popup = document.getElementById("myPopup");
        
        popup.innerHTML = details(nodeLabel, nodeTitle, nodeFname, nodeHeadFull, nodeTailFull, nodeHeadType, nodeTailType);
              
        
        // call the python function wikipedia_details to get the html details code of the node
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:5000/wikipedia_details", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        console.log("nodeLabel : ", nodeLabel, "nodeHeadType : ", nodeHeadType, "nodeTailType : ", nodeTailType);
        xhr.send(JSON.stringify({"node": nodeLabel, "node_type": nodeHeadType, "node_tail_type": nodeTailType}));
        // loading animation
        popup.innerHTML += '<div class="loader"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>';
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var details = JSON.parse(this.responseText);
                popup.innerHTML += details["html"];
                //popup.appendChild(button);       
                // loading animation stop
                popup.innerHTML = popup.innerHTML.replace('<div class="loader"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>', "");                    
                
                // button to change the name of the node
                var button = document.createElement("button");
                button.innerHTML = "Change name";
                button.onclick = function() {
                    var new_name = prompt("Please enter the new name", nodeLabel);
                    if (new_name != null) {
                        // call the python function change_name to change the name of the node
                        var xhr = new XMLHttpRequest();
                        xhr.open("POST", "http://localhost:5000/change_name", true);
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.send(JSON.stringify({"old_name": nodeLabel, "new_name": new_name}));
                        xhr.onreadystatechange = function() {
                            if (this.readyState == 4 && this.status == 200) {
                                // change the name of the node
                                node.options.label = new_name;
                                node.options.title = node.options.title.replace(nodeLabel, new_name);
                                nodeLabel = new_name;
                                nodeTitle = node.options.title;
                                // update the popup
                                popup.innerHTML = details(nodeLabel, nodeTitle, nodeFname, nodeHeadFull, nodeTailFull);
                            }
                        };
                    }
                };
                popup.appendChild(button);
                    
            }
        };
        
    
        popup.classList.toggle("show");
        // update body size to take into account the popup
        network.setSize("100%", "100%");       
    }
    });
    </script>